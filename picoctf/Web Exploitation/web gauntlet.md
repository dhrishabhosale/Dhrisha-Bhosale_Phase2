# 1. Shape Facility — Progressive Filter Bypass

> Description: Can you beat the filters?\
> Log in as admin  
> Challenge URLs: http://shape-facility.picoctf.net:63293/  and http://shape-facility.picoctf.net:63293/filter.php  
> Video analyzed: https://www.youtube.com/watch?v=PQLgFYS3lgc  
> **Video Title (from user):** pico 2020 mini web gauntlet

---

## Solution:

This challenge is a **web exploitation** / **filter bypass** task. The application enforces an evolving blacklist of tokens across rounds. The objective is to bypass each round's filters and ultimately access `filter.php` source or another view that discloses the flag. The screenshots and source provided show the exact progression used in the video walkthrough; below is a reconstructed, step-by-step report with reasoning and payloads used.

### High-level strategy
- Interact with the form (username/password) shown on the main page and observe round progression messages.  
- Use a session (browser or scripted) to preserve `$_SESSION['round']` while trying payloads.  
- Start with simple SQL comment payloads to see what the server accepts in early rounds.  
- When filters tighten, craft inputs that avoid literal banned substrings (e.g., split `admin` so `admin` does not appear verbatim), or use alternate comment syntaxes and concatenation to evade naive substring checks.  
- Reach the state where the server calls `highlight_file("filter.php")` and read the source to extract the flag (the flag is present in a comment at the bottom).

---

## Step-by-step walkthrough (with screenshots & thought process)

1. **Landing UI & Round indicator**  
   The challenge displays a round counter and an input form. This confirms the application uses stateful rounds (likely via PHP `$_SESSION`).  
   ![Challenge Header](/mnt/data/Screenshot 2025-10-27 232621.png)

2. **Round 1 — Classic SQL comment bypass**  
   The attacker submits `admin' --` in the Username field. This is a common SQL injection technique: the single quote closes a string literal and `--` starts a SQL line comment. The page advances to Round 2, so the round 1 filter is permissive enough for this payload.  
   - Payload used: `admin' --`  
   - Reason: terminate string and comment out remainder of query.  
   ![Round 1 attempt](/mnt/data/Screenshot 2025-10-27 233524.png)

3. **Round 2 — Try alternative comment style (`/*`)**  
   The next attempt uses `admin' /*` which again terminates a string and opens a block comment. This variation is tested to bypass filters that might block `--`. The UI shows progress to Round 2/5 in the video.  
   - Payload used: `admin' /*`  
   ![Round 2 attempt](/mnt/data/Screenshot 2025-10-27 233838.png)

4. **Round 3 — Filters tighten and some payloads fail**  
   At round 3, previously successful inputs are rejected (`Invalid username/password`). The server's `$filter` array for this round now includes more tokens (the screenshots of `filter.php` confirm this). This requires more creative bypasses.  
   ![Round 3 failure](/mnt/data/Screenshot 2025-10-27 233938.png)

5. **Round 4 — Creative obfuscation and bypass**  
   The attacker crafts payloads that avoid forming the literal banned substrings. For example `adm'||/*` (shown in the screenshots) avoids the literal `admin` and uses concatenation-like syntax to break filter matching while still being meaningful to the SQL parser (depending on DB). This succeeds and the UI advances to round 4.  
   - Payload observed: `adm'||/*`  
   - Thought process: Break the forbidden token (`admin`) and use operators/comments to still cause logical bypass in SQL parsing.  
   ![Round 4 success](/mnt/data/Screenshot 2025-10-27 234037.png)

6. **Inspecting the server-side `filter.php`**  
   The walkthrough shows the server-side `filter.php` file. It reveals an array of filtered tokens per round and the logic that displays filter lists or, for `$_SESSION['round'] >= 6`, calls `highlight_file("filter.php")`. The flag is present in a comment at the end of this file. The screenshots below are zoomed-in captures of the `filter.php` source used in the video.  
   ![Filter source 1](/mnt/data/Screenshot 2025-10-27 234409.png)  
   ![Filter source 2](/mnt/data/Screenshot 2025-10-27 234419.png)

7. **Flag retrieval**  
   After advancing rounds and triggering the view that highlights the `filter.php` source, the flag was discovered in a comment at the bottom of the file. The flag (as shown by you) is:
   ```
   picoCTF{y0u_m4d3_1t_79a0ddc6}
   ```

---

## Example payloads & notes (used / tested)

```
# Round 1 detection
Username: admin' --

# Round 2 attempt (alternate comment)
Username: admin' /*

# Round 3 failing example (blocked)
# many attempts will return "Invalid username/password" here

# Round 4 creative bypass (observed in video)
Username: adm'||/*
```
> Note: exact successful payloads depend on how the backend constructs the SQL query and how it parses the submitted input. The goal when filters exist is to avoid literal blocked substrings **and** provide input that still affects the query in the desired way.

---

## Flag:

```
picoCTF{y0u_m4d3_1t_79a0ddc6}
```

---

## Concepts learnt:

- **Blacklisting is brittle:** Blacklists of substrings (like `"admin"`, `"or"`, `"--"`) are easy to circumvent by obfuscation, concatenation, or alternate encodings. Use parameterized queries and whitelists instead.  
- **SQL comment styles & dialects:** Different DBs accept `--`, `#`, and `/* ... */` comments. A filter must consider all syntactic possibilities.  
- **Session-driven challenge state:** The server uses `$_SESSION['round']` to track a user's progress across requests—exploits must maintain cookies or session state.  
- **Source disclosure via debug features:** Functions like `highlight_file()` will display server files if reachable; never expose such functionality in production.  
- **Practical CTF approach:** Start with simple probes, then refine payloads based on what tokens get blocked. Automate testing once you understand the filter pattern.

---

## Notes & alternate tangents:

- If you plan to reproduce the attack, use a requests `Session()` to preserve cookies across requests. Scraping the UI for "Congrats" messages can confirm when rounds advance.  
- If filters block ASCII characters, consider bypasses like URL-encoding, Unicode homoglyphs, or exploitation through HTTP parameter parsing oddities; however these were not necessary in the video.  
- The video shows manual interactive exploration; a scripted approach can speed up reaching round >=6.

---

## Resources:

- Video analyzed: https://www.youtube.com/watch?v=PQLgFYS3lgc  
- Challenge URLs (provided in description): http://shape-facility.picoctf.net:63293/  and http://shape-facility.picoctf.net:63293/filter.php  
- OWASP SQL Injection overview: https://owasp.org/www-community/attacks/SQL_Injection  
- General CTF writeups: progressive filter bypass patterns and source-disclosure techniques.

---
